<html>
  <head>
    <title>Ftp Android 客户端上传下载方案详解 - fangxiaogang</title>
    <link href='/images/fav.png' rel='shortcut icon'>
<link href='/atom.xml' rel='alternate' type='application/rss+xml'>
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/responsive.css">
<script src="/js/jquery.js"></script>
<script src="/js/basics.js"></script>
<meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type'>


  </head>
  <body>
    <header>
  <a id='go-back-home' href='/'><img src='/images/scribble.png' alt='Home' width='53' height='59'></a>
  <p>fangxiaogang</p>
  <p>我可以！</p>
</header>

    <div id='container'>
      <div class='block'>
  
    <a class='main' href='/'>Home</a>
  
    <a class='main' href='https://fangxiaogang.github.io/About/index.html'>About</a>
  
    <a class='main' href='https://github.com/fangxiaogang'>Github</a>
  
    <a class='main' href='mailto:1005275062@qq.com'>Email</a>
  
</div>

      <section class='paging'>
  
    <div class='left'>
      <a href='/2017/06/26/仿淘宝商品详情页/'>
        ‹
      </a>
    </div>
  
  
    <div class='right'>
      <a href='/2017/06/13/真正完美的单例是什么样的/'>
        ›
      </a>
    </div>
  
</section>

      <div class='content'>
        <section class='post'>
          <h1>
            <div class='date'>2017-06-22</div>
            Ftp Android 客户端上传下载方案详解
          </h1>
          <h6 id="由于一些原因，需要使用公司电脑的-ftp-服务器来实现上传和下载一些小文件，发现网上的一些资料不全或不可用或年代久远，故将源码分享出来，希望有所对新人有所帮助。"><a href="#由于一些原因，需要使用公司电脑的-ftp-服务器来实现上传和下载一些小文件，发现网上的一些资料不全或不可用或年代久远，故将源码分享出来，希望有所对新人有所帮助。" class="headerlink" title="由于一些原因，需要使用公司电脑的 ftp 服务器来实现上传和下载一些小文件，发现网上的一些资料不全或不可用或年代久远，故将源码分享出来，希望有所对新人有所帮助。"></a>由于一些原因，需要使用公司电脑的 ftp 服务器来实现上传和下载一些小文件，发现网上的一些资料不全或不可用或年代久远，故将源码分享出来，希望有所对新人有所帮助。</h6><p><br></p>
<p>使用 ftp 服务器需要的参数有网址或ip、端口、用户名和密码。在项目中我使用的一个名为  的库，接下来只需三个 java 类即可实现上传、下载、删除。由于在项目中只需上传下载指定文件，所以暂时没有加入选择文件功能，如需要自行加入即可。在代码中该有的注释都有了，方法简洁明了。完整代码已经上至 <a href="https://github.com/fangxiaogang/FtpDome" target="_blank" rel="external">Github</a></p>
<p><br></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div></pre></td><td class="code"><pre><div class="line">public class FTP &#123;</div><div class="line">	/**</div><div class="line">	 * 服务器名.</div><div class="line">	 */</div><div class="line">	private String hostName;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 端口号</div><div class="line">	 */</div><div class="line">	private int serverPort;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 用户名.</div><div class="line">	 */</div><div class="line">	private String userName;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 密码.</div><div class="line">	 */</div><div class="line">	private String password;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * FTP连接.</div><div class="line">	 */</div><div class="line">	private FTPClient ftpClient;</div><div class="line"></div><div class="line">	public FTP() &#123;</div><div class="line">		//hostname的网址不需要加入ftp：//  直接输入网址即可</div><div class="line">		this.hostName = &quot;www.socket.net.cn&quot;;</div><div class="line">		this.serverPort = 1001;//默认为21，这个可手动更改</div><div class="line">		this.userName = &quot;&quot;;//账号</div><div class="line">		this.password = &quot;&quot;;//密码</div><div class="line">		this.ftpClient = new FTPClient();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	// -------------------------------------------------------文件上传方法------------------------------------------------</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 上传单个文件.</div><div class="line">	 * </div><div class="line">	 * @param localFile</div><div class="line">	 *            本地文件</div><div class="line">	 * @param remotePath</div><div class="line">	 *            FTP目录</div><div class="line">	 * @param listener</div><div class="line">	 *            监听器</div><div class="line">	 * @throws IOException</div><div class="line">	 */</div><div class="line">	public void uploadSingleFile(File singleFile, String remotePath,</div><div class="line">			UploadProgressListener listener) throws IOException &#123;</div><div class="line"></div><div class="line">		// 上传之前初始化</div><div class="line">		this.uploadBeforeOperate(remotePath, listener);</div><div class="line"></div><div class="line">		boolean flag;</div><div class="line">		flag = uploadingSingle(singleFile, listener);</div><div class="line">		if (flag) &#123;</div><div class="line">			listener.onUploadProgress(MainActivity.FTP_UPLOAD_SUCCESS, 0,</div><div class="line">					singleFile);</div><div class="line">		&#125; else &#123;</div><div class="line">			listener.onUploadProgress(MainActivity.FTP_UPLOAD_FAIL, 0,</div><div class="line">					singleFile);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		// 上传完成之后关闭连接</div><div class="line">		this.uploadAfterOperate(listener);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 上传多个文件.</div><div class="line">	 * </div><div class="line">	 * @param localFile</div><div class="line">	 *            本地文件</div><div class="line">	 * @param remotePath</div><div class="line">	 *            FTP目录</div><div class="line">	 * @param listener</div><div class="line">	 *            监听器</div><div class="line">	 * @throws IOException</div><div class="line">	 */</div><div class="line">	public void uploadMultiFile(LinkedList&lt;File&gt; fileList, String remotePath,</div><div class="line">			UploadProgressListener listener) throws IOException &#123;</div><div class="line"></div><div class="line">		// 上传之前初始化</div><div class="line">		this.uploadBeforeOperate(remotePath, listener);</div><div class="line"></div><div class="line">		boolean flag;</div><div class="line"></div><div class="line">		for (File singleFile : fileList) &#123;</div><div class="line">			flag = uploadingSingle(singleFile, listener);</div><div class="line">			if (flag) &#123;</div><div class="line">				listener.onUploadProgress(MainActivity.FTP_UPLOAD_SUCCESS, 0,</div><div class="line">						singleFile);</div><div class="line">			&#125; else &#123;</div><div class="line">				listener.onUploadProgress(MainActivity.FTP_UPLOAD_FAIL, 0,</div><div class="line">						singleFile);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		// 上传完成之后关闭连接</div><div class="line">		this.uploadAfterOperate(listener);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 上传单个文件.</div><div class="line">	 * </div><div class="line">	 * @param localFile</div><div class="line">	 *            本地文件</div><div class="line">	 * @return true上传成功, false上传失败</div><div class="line">	 * @throws IOException</div><div class="line">	 */</div><div class="line">	private boolean uploadingSingle(File localFile,</div><div class="line">			UploadProgressListener listener) throws IOException &#123;</div><div class="line">		boolean flag = true;</div><div class="line">		// 不带进度的方式</div><div class="line">		// // 创建输入流</div><div class="line">		// InputStream inputStream = new FileInputStream(localFile);</div><div class="line">		// // 上传单个文件</div><div class="line">		// flag = ftpClient.storeFile(localFile.getName(), inputStream);</div><div class="line">		// // 关闭文件流</div><div class="line">		// inputStream.close();</div><div class="line"></div><div class="line">		// 带有进度的方式</div><div class="line">		BufferedInputStream buffIn = new BufferedInputStream(</div><div class="line">				new FileInputStream(localFile));</div><div class="line">		ProgressInputStream progressInput = new ProgressInputStream(buffIn,</div><div class="line">				listener, localFile);</div><div class="line">		flag = ftpClient.storeFile(localFile.getName(), progressInput);</div><div class="line">		buffIn.close();</div><div class="line"></div><div class="line">		return flag;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	/**</div><div class="line">	 * 上传文件之前初始化相关参数</div><div class="line">	 * </div><div class="line">	 * @param remotePath</div><div class="line">	 *            FTP目录</div><div class="line">	 * @param listener</div><div class="line">	 *            监听器</div><div class="line">	 * @throws IOException</div><div class="line">	 */</div><div class="line">	private void uploadBeforeOperate(String remotePath,</div><div class="line">			UploadProgressListener listener) throws IOException &#123;</div><div class="line"></div><div class="line">		// 打开FTP服务</div><div class="line">		try &#123;</div><div class="line">			this.openConnect();</div><div class="line">			listener.onUploadProgress(MainActivity.FTP_CONNECT_SUCCESSS, 0,</div><div class="line">					null);</div><div class="line">		&#125; catch (IOException e1) &#123;</div><div class="line">			e1.printStackTrace();</div><div class="line">			listener.onUploadProgress(MainActivity.FTP_CONNECT_FAIL, 0, null);</div><div class="line">			return;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		// 设置模式</div><div class="line">		ftpClient.setFileTransferMode(org.apache.commons.net.ftp.FTP.STREAM_TRANSFER_MODE);</div><div class="line">		// FTP下创建文件夹</div><div class="line">		ftpClient.makeDirectory(remotePath);</div><div class="line">		// 改变FTP目录</div><div class="line">		ftpClient.changeWorkingDirectory(remotePath);</div><div class="line">		// 上传单个文件</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 上传完成之后关闭连接</div><div class="line">	 * </div><div class="line">	 * @param listener</div><div class="line">	 * @throws IOException</div><div class="line">	 */</div><div class="line">	private void uploadAfterOperate(UploadProgressListener listener)</div><div class="line">			throws IOException &#123;</div><div class="line">		this.closeConnect();</div><div class="line">		listener.onUploadProgress(MainActivity.FTP_DISCONNECT_SUCCESS, 0, null);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	// -------------------------------------------------------文件下载方法------------------------------------------------</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 下载单个文件，可实现断点下载.</div><div class="line">	 * </div><div class="line">	 * @param serverPath</div><div class="line">	 *            Ftp目录及文件路径</div><div class="line">	 * @param localPath</div><div class="line">	 *            本地目录</div><div class="line">	 * @param fileName       </div><div class="line">	 *            下载之后的文件名称</div><div class="line">	 * @param listener</div><div class="line">	 *            监听器</div><div class="line">	 * @throws IOException</div><div class="line">	 */</div><div class="line">	public void downloadSingleFile(String serverPath, String localPath, String fileName, DownLoadProgressListener listener)</div><div class="line">			throws Exception &#123;</div><div class="line"></div><div class="line">		// 打开FTP服务</div><div class="line">		try &#123;</div><div class="line">			this.openConnect();</div><div class="line">			listener.onDownLoadProgress(MainActivity.FTP_CONNECT_SUCCESSS, 0, null);</div><div class="line">		&#125; catch (IOException e1) &#123;</div><div class="line">			e1.printStackTrace();</div><div class="line">			listener.onDownLoadProgress(MainActivity.FTP_CONNECT_FAIL, 0, null);</div><div class="line">			return;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		// 先判断服务器文件是否存在</div><div class="line">		FTPFile[] files = ftpClient.listFiles(serverPath);</div><div class="line">		if (files.length == 0) &#123;</div><div class="line">			listener.onDownLoadProgress(MainActivity.FTP_FILE_NOTEXISTS, 0, null);</div><div class="line">			return;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		//创建本地文件夹</div><div class="line">		File mkFile = new File(localPath);</div><div class="line">		if (!mkFile.exists()) &#123;</div><div class="line">			mkFile.mkdirs();</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		localPath = localPath + fileName;</div><div class="line">		// 接着判断下载的文件是否能断点下载</div><div class="line">		long serverSize = files[0].getSize(); // 获取远程文件的长度</div><div class="line">		File localFile = new File(localPath);</div><div class="line">		long localSize = 0;</div><div class="line">		if (localFile.exists()) &#123;</div><div class="line">			localSize = localFile.length(); // 如果本地文件存在，获取本地文件的长度</div><div class="line">			if (localSize &gt;= serverSize) &#123;</div><div class="line">				File file = new File(localPath);</div><div class="line">				file.delete();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		// 进度</div><div class="line">		long step = serverSize / 100;</div><div class="line">		long process = 0;</div><div class="line">		long currentSize = 0;</div><div class="line">		// 开始准备下载文件</div><div class="line">		OutputStream out = new FileOutputStream(localFile, true);</div><div class="line">		ftpClient.setRestartOffset(localSize);</div><div class="line">		InputStream input = ftpClient.retrieveFileStream(serverPath);</div><div class="line">		byte[] b = new byte[1024];</div><div class="line">		int length = 0;</div><div class="line">		while ((length = input.read(b)) != -1) &#123;</div><div class="line">			out.write(b, 0, length);</div><div class="line">			currentSize = currentSize + length;</div><div class="line">			if (currentSize / step != process) &#123;</div><div class="line">				process = currentSize / step;</div><div class="line">				if (process % 5 == 0) &#123;  //每隔%5的进度返回一次</div><div class="line">					listener.onDownLoadProgress(MainActivity.FTP_DOWN_LOADING, process, null);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		out.flush();</div><div class="line">		out.close();</div><div class="line">		input.close();</div><div class="line">		</div><div class="line">		// 此方法是来确保流处理完毕，如果没有此方法，可能会造成现程序死掉</div><div class="line">		if (ftpClient.completePendingCommand()) &#123;</div><div class="line">			listener.onDownLoadProgress(MainActivity.FTP_DOWN_SUCCESS, 0, new File(localPath));</div><div class="line">		&#125; else &#123;</div><div class="line">			listener.onDownLoadProgress(MainActivity.FTP_DOWN_FAIL, 0, null);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		// 下载完成之后关闭连接</div><div class="line">		this.closeConnect();</div><div class="line">		listener.onDownLoadProgress(MainActivity.FTP_DISCONNECT_SUCCESS, 0, null);</div><div class="line"></div><div class="line">		return;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	// -------------------------------------------------------文件删除方法------------------------------------------------</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 删除Ftp下的文件.</div><div class="line">	 * </div><div class="line">	 * @param serverPath</div><div class="line">	 *            Ftp目录及文件路径</div><div class="line">	 * @param listener</div><div class="line">	 *            监听器</div><div class="line">	 * @throws IOException</div><div class="line">	 */</div><div class="line">	public void deleteSingleFile(String serverPath, DeleteFileProgressListener listener)</div><div class="line">			throws Exception &#123;</div><div class="line"></div><div class="line">		// 打开FTP服务</div><div class="line">		try &#123;</div><div class="line">			this.openConnect();</div><div class="line">			listener.onDeleteProgress(MainActivity.FTP_CONNECT_SUCCESSS);</div><div class="line">		&#125; catch (IOException e1) &#123;</div><div class="line">			e1.printStackTrace();</div><div class="line">			listener.onDeleteProgress(MainActivity.FTP_CONNECT_FAIL);</div><div class="line">			return;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		// 先判断服务器文件是否存在</div><div class="line">		FTPFile[] files = ftpClient.listFiles(serverPath);</div><div class="line">		if (files.length == 0) &#123;</div><div class="line">			listener.onDeleteProgress(MainActivity.FTP_FILE_NOTEXISTS);</div><div class="line">			return;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		//进行删除操作</div><div class="line">		boolean flag = true;</div><div class="line">		flag = ftpClient.deleteFile(serverPath);</div><div class="line">		if (flag) &#123;</div><div class="line">			listener.onDeleteProgress(MainActivity.FTP_DELETEFILE_SUCCESS);</div><div class="line">		&#125; else &#123;</div><div class="line">			listener.onDeleteProgress(MainActivity.FTP_DELETEFILE_FAIL);</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		// 删除完成之后关闭连接</div><div class="line">		this.closeConnect();</div><div class="line">		listener.onDeleteProgress(MainActivity.FTP_DISCONNECT_SUCCESS);</div><div class="line">		</div><div class="line">		return;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	// -------------------------------------------------------打开关闭连接------------------------------------------------</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 打开FTP服务.</div><div class="line">	 * </div><div class="line">	 * @throws IOException</div><div class="line">	 */</div><div class="line">	public void openConnect() throws IOException &#123;</div><div class="line"></div><div class="line">		ftpClient.setControlEncoding(&quot;UTF-8&quot;);</div><div class="line">		int reply; // 服务器响应值</div><div class="line">		// 连接至服务器</div><div class="line">		ftpClient.connect(hostName, serverPort);</div><div class="line">		// 获取响应值</div><div class="line">		reply = ftpClient.getReplyCode();</div><div class="line">		if (!FTPReply.isPositiveCompletion(reply)) &#123;</div><div class="line">			// 断开连接</div><div class="line">			ftpClient.disconnect();</div><div class="line">			throw new IOException(&quot;connect fail: &quot; + reply);</div><div class="line">		&#125;</div><div class="line">		// 登录到服务器</div><div class="line">		ftpClient.login(userName, password);</div><div class="line">		// 获取响应值</div><div class="line">		reply = ftpClient.getReplyCode();</div><div class="line">		if (!FTPReply.isPositiveCompletion(reply)) &#123;</div><div class="line">			// 断开连接</div><div class="line">			ftpClient.disconnect();</div><div class="line">			throw new IOException(&quot;connect fail: &quot; + reply);</div><div class="line">		&#125; else &#123;</div><div class="line">			// 获取登录信息</div><div class="line">			FTPClientConfig config = new FTPClientConfig(ftpClient</div><div class="line">					.getSystemType().split(&quot; &quot;)[0]);</div><div class="line">			config.setServerLanguageCode(&quot;zh&quot;);</div><div class="line">			ftpClient.configure(config);</div><div class="line">			// 使用被动模式设为默认</div><div class="line">			ftpClient.enterLocalPassiveMode();</div><div class="line">			// 二进制文件支持</div><div class="line">			ftpClient</div><div class="line">					.setFileType(org.apache.commons.net.ftp.FTP.BINARY_FILE_TYPE);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/**</div><div class="line">	 * 关闭FTP服务.</div><div class="line">	 * </div><div class="line">	 * @throws IOException</div><div class="line">	 */</div><div class="line">	public void closeConnect() throws IOException &#123;</div><div class="line">		if (ftpClient != null) &#123;</div><div class="line">			// 退出FTP</div><div class="line">			ftpClient.logout();</div><div class="line">			// 断开连接</div><div class="line">			ftpClient.disconnect();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	// ---------------------------------------------------上传、下载、删除监听---------------------------------------------</div><div class="line">	</div><div class="line">	/*</div><div class="line">	 * 上传进度监听</div><div class="line">	 */</div><div class="line">	public interface UploadProgressListener &#123;</div><div class="line">		public void onUploadProgress(String currentStep, long uploadSize, File file);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/*</div><div class="line">	 * 下载进度监听</div><div class="line">	 */</div><div class="line">	public interface DownLoadProgressListener &#123;</div><div class="line">		public void onDownLoadProgress(String currentStep, long downProcess, File file);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	/*</div><div class="line">	 * 文件删除监听</div><div class="line">	 */</div><div class="line">	public interface DeleteFileProgressListener &#123;</div><div class="line">		public void onDeleteProgress(String currentStep);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
          <br>
<p>fangxiaogang</p>
<p><img src='/images/scribble3.png' alt='scribble'></p>

        </section>
      </div>
      
      <div class='block'>
  
    <a class='main' href='/'>Home</a>
  
    <a class='main' href='https://fangxiaogang.github.io/About/index.html'>About</a>
  
    <a class='main' href='https://github.com/fangxiaogang'>Github</a>
  
    <a class='main' href='mailto:1005275062@qq.com'>Email</a>
  
</div>

    </div>
    <footer>
  <span class='muted'>&copy;  Power by fangxiaogang.</span><br>
  <a href='https://github.com/fangxiaogang' class='muted'>fangxiaogang</a>
  <br>
  <br>
  <img src='/images/scribble2.png' alt='scribble' />
</footer>

  </body>
</html>
